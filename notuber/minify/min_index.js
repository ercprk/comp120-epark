let map,currentLocationPosition,currentLocationMarker,carIcon,currentLocationIcon,vehicles,markers=new Array;function initMap(){currentLocationPosition=new google.maps.LatLng({lat:42.352271,lng:-71.055242}),carIcon={url:"./images/car.png",scaledSize:new google.maps.Size(20,40)},currentLocationIcon={url:"./images/current_location.png",scaledSize:new google.maps.Size(40,40)},map=new google.maps.Map(document.getElementById("map"),{center:currentLocationPosition,zoom:2}),navigator.geolocation.getCurrentPosition(n=>{currentLocationPosition=new google.maps.LatLng({lat:n.coords.latitude,lng:n.coords.longitude}),map.setCenter(currentLocationPosition),currentLocationMarker=new google.maps.Marker({position:currentLocationPosition,icon:currentLocationIcon,map:map}),callRideHailingAPI()})}function callRideHailingAPI(){var n;(n=new XMLHttpRequest).open("POST","https://afternoon-hamlet-03118.herokuapp.com/rides",!0),n.onreadystatechange=function(){if(this.readyState==this.DONE&&200==this.status&&!("error"in this.response)){(vehicles=this.response).forEach((n,o,e)=>{var t=new google.maps.LatLng({lat:n.lat,lng:n.lng});n.distance=.000621371192*google.maps.geometry.spherical.computeDistanceBetween(currentLocationPosition,t);var a=new google.maps.Marker({position:t,icon:carIcon,map:map});a.addListener("click",()=>{const o='<div id="content"><h3>'+n.username+"</h3><p>distance away: <strong>"+n.distance+" miles</strong></p></div>";new google.maps.InfoWindow({content:o}).open({anchor:a,map:map,shouldFocus:!1})}),markers.push(a)});const n=vehicles.reduce(function(n,o){return n.distance<o.distance?n:o});currentLocationMarker.addListener("click",()=>{const o='<div id="content"><h3>closest vehicle</h3><li>username: <strong>'+n.username+"</strong></li><li>id: <strong>"+n.id+"</strong></li><li>latitude: <strong>"+n.lat+"</strong></li><li>longitude: <strong>"+n.lng+"</strong></li><li>distance away: <strong>"+n.distance+" miles</strong></li></ul></div>";new google.maps.InfoWindow({content:o}).open({anchor:currentLocationMarker,map:map,shouldFocus:!1})});const o=[{lat:currentLocationPosition.lat(),lng:currentLocationPosition.lng()},{lat:n.lat,lng:n.lng}];new google.maps.Polyline({path:o,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(map)}},n.responseType="json",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("username=gDL4eabb&lat="+currentLocationPosition.lat()+"&lng="+currentLocationPosition.lng())}